### 与查询不一样的是，更新会涉及到2个重要日志模块，redo log（重做日志）和 binlog（归档日志）。
    保障数据安全性和可靠性
#### 两种日志不同点：
    1. redo log是innoDb引擎特有的，binlog是mysql的server层实现的，所有引擎都可以用
    2. redo log是物理日志，记录的是“在某个数据页上做了什么修改”；binlog是逻辑日志，记录的是这个语句的原始逻辑，比如“给ID=2这一行的c字段加1”
    3. redo log是循环写的，空间固定会用完；binlog是可以追加写入的。“追加写”是指binlog文件写到一定大小后会切换到下一个，并不会覆盖以前的日志。
    4. redo log用于保证crash-safe能力；binlog用于归档。

###  1. 更新语句的执行流程
    1.  先执行上变“查询”的步骤
    2. 执行器先找引擎取ID=2这一行。ID是主键，引擎直接用树搜索找到这一行。如果ID=2这一行所在的数据页本来就在内存中，就直接返回给执行器；否则，需要先从磁盘读入内存，然后再返回。
    3. 执行器拿到引擎给的行数据，把这个值加上1，比如原来是N，现在就是N+1，得到新的一行数据，再调用引擎接口写入这行新数据。
    4. 引擎将这行新数据更新到内存中，同时将这个更新操作记录到redo log里面，此时redo log处于prepare状态。然后告知执行器执行完成了，随时可以提交事务。
    5. 执行器生成这个操作的binlog，并把binlog写入磁盘。
    6. 执行器调用引擎的提交事务接口，引擎把刚刚写入的redo log改成提交（commit）状态，更新完成。

#### 典型事务操作流程
    1. server层接收sql更新请求
    2. 记录undo log
    3. 写入redo log
    4. 写入binlog
    5. redo log commit

#### 两阶段提交
    1. 为什么必须有“两阶段提交”呢？这是为了让两份日志之间的逻辑一致。
    准备阶段
        ——innoDb写入redo log，处于prepare状态
        ——通知server层写入binlog
    提交阶段
        ——server层写入binlog
        ——innoDb将redo log改成commit状态


#### 面试问答：
    1.mysql有了binlog为什么还需要redo log？
        1. binglog是记录sql具体操作，用于备份
        2. redolog是innoDb特有，采用的是循环写入方式，记录的是具体物理操作，恢复速度快
    2. mysql如何保证一个事务一致性？
        1. 两阶段提交可保证事务的一致性
